<!DOCTYPE html>
<html lang="pt-br" data-theme="dark" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trackfy - Editar Moto</title>
    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.12.10/dist/full.min.css" rel="stylesheet" type="text/css" />
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-black text-green-500 min-h-screen flex flex-col">

<!-- Navbar -->
<div class="navbar bg-green-700 text-white px-6">
    <div class="flex-1">
        <a class="btn btn-ghost normal-case text-2xl font-bold">Trackfy Dashboard</a>
    </div>
    <div class="flex-none">
        <span class="mr-4">Editando Moto: <span th:text="${bike.placa}">ABC1234</span></span>
        <a href="/web/logout" class="btn btn-outline border-white text-white hover:bg-green-600">Sair</a>
    </div>
</div>

<!-- Mensagens -->
<div th:if="${message}" class="mx-6 mt-4 p-3 bg-green-900/40 border border-green-500 rounded-md text-sm text-green-300">
    <span th:text="${message}"></span>
</div>

<div th:if="${error}" class="mx-6 mt-4 p-3 bg-red-900/40 border border-red-500 rounded-md text-sm text-red-300">
    <span th:text="${error}"></span>
</div>

<!-- Conteúdo -->
<div class="flex flex-col items-center p-8 gap-8 flex-1">

    <!-- Formulário de Edição da Moto -->
    <div class="card w-full max-w-4xl bg-neutral text-white shadow-xl">
        <div class="card-body">
            <h2 class="card-title text-green-400 text-3xl mb-6">Editar Moto</h2>

            <form th:action="@{'/web/bike/edit/' + ${bike.placa}}" th:object="${bike}" method="post" class="space-y-6">

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Placa (readonly) -->
                    <div>
                        <label class="block text-sm font-medium text-green-400 mb-2">Placa</label>
                        <input type="text" th:value="${bike.placa}" readonly
                               class="w-full px-4 py-2.5 border border-gray-600 rounded-lg bg-gray-800 text-gray-400 cursor-not-allowed"/>
                    </div>

                    <!-- ID do Chassi -->
                    <div>
                        <label class="block text-sm font-medium text-green-400 mb-2">ID do Chassi</label>
                        <input type="number" th:field="*{idChassi}"
                               class="w-full px-4 py-2.5 border border-green-600 rounded-lg bg-black text-white focus:outline-none focus:ring-2 focus:ring-green-500"/>
                        <p class="text-red-500 text-sm mt-1" th:if="${#fields.hasErrors('idChassi')}" th:errors="*{idChassi}"></p>
                    </div>

                    <!-- Modelo -->
                    <div>
                        <label class="block text-sm font-medium text-green-400 mb-2">Modelo</label>
                        <select th:field="*{modelo}"
                                class="block w-full px-4 py-2.5 border border-green-600 rounded-lg bg-black text-white focus:outline-none focus:ring-2 focus:ring-green-500">
                            <option th:each="modelo : ${T(com.example.challenge_mottu_java.Enums.ModelsBike).values()}"
                                    th:value="${modelo.name()}"
                                    th:text="${modelo.name()}"
                                    th:selected="${modelo == bike.modelo}">
                            </option>
                        </select>
                        <p class="text-red-500 text-sm mt-1" th:if="${#fields.hasErrors('modelo')}" th:errors="*{modelo}"></p>
                    </div>

                    <!-- Status -->
                    <div>
                        <label class="block text-sm font-medium text-green-400 mb-2">Status</label>
                        <select th:field="*{status}"
                                class="block w-full px-4 py-2.5 border border-green-600 rounded-lg bg-black text-white focus:outline-none focus:ring-2 focus:ring-green-500">
                            <option th:each="status : ${T(com.example.challenge_mottu_java.Enums.StatusBike).values()}"
                                    th:value="${status.name()}"
                                    th:text="${status.name()}"
                                    th:selected="${status == bike.status}">
                            </option>
                        </select>
                        <p class="text-red-500 text-sm mt-1" th:if="${#fields.hasErrors('status')}" th:errors="*{status}"></p>
                    </div>

                    <!-- Localização -->
                    <div>
                        <label class="block text-sm font-medium text-green-400 mb-2">Localização</label>
                        <select th:field="*{localizacao}"
                                class="block w-full px-4 py-2.5 border border-green-600 rounded-lg bg-black text-white focus:outline-none focus:ring-2 focus:ring-green-500">
                            <option th:each="localizacao : ${T(com.example.challenge_mottu_java.Enums.LocationBike).values()}"
                                    th:value="${localizacao.name()}"
                                    th:text="${localizacao.name()}"
                                    th:selected="${localizacao == bike.localizacao}">
                            </option>
                        </select>
                        <p class="text-red-500 text-sm mt-1" th:if="${#fields.hasErrors('localizacao')}" th:errors="*{localizacao}"></p>
                    </div>

                    <!-- Court (hidden) -->
                    <input type="hidden" th:field="*{court.acessCode}"/>
                </div>

                <!-- Botões da Moto -->
                <div class="flex space-x-3 pt-4">
                    <button type="submit"
                            class="btn bg-green-600 hover:bg-green-500 text-black border-0 px-6 py-2 font-semibold">
                        Atualizar Moto
                    </button>
                    <a th:href="@{'/web/bike/' + ${bike.placa}}"
                       class="btn bg-gray-600 hover:bg-gray-500 text-white border-0 px-6 py-2 font-semibold">
                        Cancelar
                    </a>
                </div>
            </form>
        </div>
    </div>

    <!-- Seção de Pendências -->
    <div class="w-full max-w-4xl">
        <div class="card bg-neutral text-white shadow-xl">
            <div class="card-body">
                <h3 class="card-title text-green-400 text-2xl mb-6">Pendências da Moto</h3>

                <!-- Mensagem quando não há pendências -->
                <div th:if="${#lists.isEmpty(bike.pendencias)}" class="text-center text-gray-400 py-8">
                    <svg class="w-16 h-16 mx-auto mb-4 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                              d="M12 8c-3.3137 0-6 2.6863-6 6s2.6863 6 6 6 6-2.6863 6-6-2.6863-6-6-6z"/>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 14v-4"/>
                    </svg>
                    <p class="text-lg">Nenhuma pendência registrada</p>
                    <a th:href="@{/web/pending/form}" class="btn bg-green-600 hover:bg-green-500 text-black mt-4">
                        Adicionar Pendência
                    </a>
                </div>

                <!-- Lista de Pendências Editáveis -->
                <div th:if="${!#lists.isEmpty(bike.pendencias)}" class="space-y-4">
                    <div th:each="pending, iterStat : ${bike.pendencias}" class="border border-green-600 rounded-lg p-4 bg-black">
                        <form th:action="@{'/web/bike/pending/update/' + ${pending.id}}" method="post" class="space-y-4">
                            <input type="hidden" name="bikePlaca" th:value="${bike.placa}"/>

                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <!-- Número -->
                                <div>
                                    <label class="block text-sm font-medium text-green-400 mb-2">Número</label>
                                    <select name="number" th:value="${pending.number}"
                                            class="block w-full px-3 py-2 border border-green-600 rounded-lg bg-black text-white focus:outline-none focus:ring-2 focus:ring-green-500 text-sm">
                                        <option value="1" th:selected="${pending.number == 1}">1</option>
                                        <option value="2" th:selected="${pending.number == 2}">2</option>
                                        <option value="3" th:selected="${pending.number == 3}">3</option>
                                    </select>
                                </div>

                                <!-- Status -->
                                <div>
                                    <label class="block text-sm font-medium text-green-400 mb-2">Status</label>
                                    <select name="status" th:value="${pending.status}"
                                            class="block w-full px-3 py-2 border border-green-600 rounded-lg bg-black text-white focus:outline-none focus:ring-2 focus:ring-green-500 text-sm">
                                        <option th:each="status : ${T(com.example.challenge_mottu_java.Enums.StatusPending).values()}"
                                                th:value="${status.name()}"
                                                th:text="${status.name()}"
                                                th:selected="${status == pending.status}">
                                        </option>
                                    </select>
                                </div>

                                <!-- Botões de Ação -->
                                <div class="flex space-x-2 items-end">
                                    <button type="submit"
                                            class="btn btn-sm bg-green-600 hover:bg-green-500 text-black border-0 font-semibold">
                                        Salvar
                                    </button>
                                </div>
                            </div>

                            <!-- Descrição -->
                            <div>
                                <label class="block text-sm font-medium text-green-400 mb-2">Descrição</label>
                                <textarea name="description" th:text="${pending.description}"
                                          rows="3"
                                          class="w-full px-3 py-2 border border-green-600 rounded-lg bg-black text-white focus:outline-none focus:ring-2 focus:ring-green-500 text-sm resize-none"></textarea>
                            </div>
                        </form>

                        <!-- Botão de Deletar (separado) -->
                        <div class="mt-4 text-right">
                            <form th:action="@{'/web/bike/pending/delete/' + ${pending.id}}" method="post" style="display: inline;">
                                <input type="hidden" name="bikePlaca" th:value="${bike.placa}"/>
                                <button type="submit"
                                        class="btn btn-sm bg-red-600 hover:bg-red-500 text-white border-0 font-semibold"
                                        onclick="return confirm('Tem certeza que deseja deletar esta pendência?')">
                                    Deletar
                                </button>
                            </form>
                        </div>
                    </div>

                    <!-- Botão para adicionar nova pendência -->
                    <div class="text-center pt-4">
                        <a th:href="@{/web/pending/form}" class="btn bg-green-600 hover:bg-green-500 text-black">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                            </svg>
                            Adicionar Nova Pendência
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Botão Voltar -->
    <div class="w-full max-w-4xl flex justify-end">
        <a th:href="@{'/web/bike/' + ${bike.placa}}"
           class="btn bg-gray-600 hover:bg-gray-500 text-white border-0 px-6 py-2 font-semibold">
            Voltar aos Detalhes
        </a>
    </div>

</div>

</body>
</html>